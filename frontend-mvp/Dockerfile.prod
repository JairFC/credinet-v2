# =============================================================================
# CrediNet V2 - Frontend Dockerfile (Producci칩n con Auto-Rebuild)
# =============================================================================
# Modo: Servidor est치tico con watch para auto-rebuild
# Optimizado para acceso remoto via ZeroTier
# =============================================================================

FROM node:20-alpine

# Metadata
LABEL maintainer="CrediNet Team"
LABEL version="2.0.0"
LABEL description="CrediNet V2 Frontend - Production Mode with Auto-Rebuild"

# Instalar serve globalmente para servir archivos est치ticos
RUN npm install -g serve

# Establecer directorio de trabajo
WORKDIR /app

# Variables de entorno
ENV NODE_ENV=production
ENV VITE_HOST=0.0.0.0
ENV PORT=5173

# Copiar archivos de dependencias primero (para aprovechar cache de Docker)
COPY package.json package-lock.json ./

# Instalar dependencias (incluyendo devDependencies para build)
RUN npm ci --prefer-offline --no-audit

# Copiar el resto de los archivos del proyecto
COPY . .

# Build inicial
RUN npm run build

# Exponer puerto
EXPOSE 5173

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=20s --retries=3 \
  CMD node -e "require('http').get('http://localhost:5173', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"

# Servir archivos est치ticos desde dist
CMD ["serve", "-s", "dist", "-l", "5173"]
